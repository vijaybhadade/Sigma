<% layout('layout/Boilerplate.ejs') %>

<body>
  <div class="row mt-3">
    <div class="col-8 offset-2">
      <h2>
        <%= listing.title %>
      </h2>
    </div>

    <div class="listing-card col-6 offset-2 card ">
      <img src="<%= listing.image.url %>" alt="listing_image"
        class="card-img-top show-img">
      <div class="card-body">
        <p class="card-text">
          <b>Owner by:</b>
          <%= listing.owner ? listing.owner.username : "Unknown" %>
        </p>
        <p class="card-text">
          <%= listing.description %>
        </p>
        <p class="card-text">&#8377; <%= listing.price.toLocaleString("en-IN")
          %>
        </p>
        <p class="card-text">
          <%= listing.location %>
        </p>
        <p class="card-text">
          <%= listing.country %>
        </p>
      </div>
    </div>

    <% if(currUser && listing.owner._id.equals(currUser._id)) { %>

    <div class="btns col-6 offset-2 d-flex mt-3">
      <a href="/listings/<%= listing._id %>/edit"
        class="btn btn-dark show-edit">Edit</a>
      <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST"
        class="ms-3">
        <button class="btn show-edit">Delete</button>
      </form>
    </div>
    <% } %>

    <!-- âœ… Review Form with Working Validation -->
    <div class="col-8 offset-3 mt-3 commentArea">
      <form action="/listings/<%= listing._id %>/reviews" method="POST"
        class="mb-3 needs-validation" novalidate>
        <hr>
        <h4>Leave a review:</h4>
        <% if(currUser) { %>
        
         
        <div class="mb-3 mt-3">
        <fieldset class="starability-slot">
          <legend>First rating:</legend>
          <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]"
            value="1 " checked
            aria-label="No rating." />
          <input type="radio" id="first-rate1" name="review[rating]"
            value="1" />
          <label for="first-rate1" title="Terrible">1 star</label>
          <input type="radio" id="first-rate2" name="review[rating]"
            value="2" />
          <label for="first-rate2" title="Not good">2 stars</label>
          <input type="radio" id="first-rate3" name="review[rating]"
            value="3" />
          <label for="first-rate3" title="Average">3 stars</label>
          <input type="radio" id="first-rate4" name="review[rating]"
            value="4" />
          <label for="first-rate4" title="Very good">4 stars</label>
          <input type="radio" id="first-rate5" name="review[rating]"
            value="5" />
          <label for="first-rate5" title="Amazing">5 stars</label>
        </fieldset>
          </div>
        <div class="mb-3 mt-3">
          <label for="comment" class="form-label">Comment:</label>
          <textarea name="review[comment]" id="comment" rows="6" cols="45"
            class="form-control"
            placeholder="Please enter comments" required></textarea>
          <div class="invalid-feedback">
            Please add some review
          </div>
        </div>

        <button type="submit" class="btn btn-outline-dark">Submit</button>
      </form>
      <hr>
      <% } %>
      <!-- this is reviewcomment part  -->

      <h4>All Reviews:</h4>

      <div class="row   ">
        <ul>
          <% for (let review of listing.reviews) { %>
          <div class="card commentReview col-6 mb-3 ms-3">
            <div class="card-body">

              <p class="card-title ms-3"> <b>
                  <%= review.author.username %>
                </b></p>
              <p class="starability-result card-text"
                data-rating="<%= review.rating%>"></p>
              <p class="card-text ms-3">
                <%= review.comment %>
              </p>

            </div>
            <form
              action="/listings/<%=listing._id %>/reviews/<%=review._id%>?_method=DELETE"
              method="post"
              class="mb-3  small ms-3">
              <button class="btn  btn-outline-danger">Delete</button>
            </form>
          </div>

          <% } %>
        </ul>
      </div>

    </div>

  </div>

</body>